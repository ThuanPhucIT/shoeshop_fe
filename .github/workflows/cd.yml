name: CD Pipeline

on: 
  workflow_run: 
    workflows: ["Build & Push CI"]
    types: 
      - completed
        
jobs:
  deploy:
    runs-on: self-hosted
    steps:

      - name: Delete old docker container
        run: docker rm -f shoeshop_fe || true
        
      - name: Delete old image
        run: docker rmi ${{ secrets.DOCKERHUB_USER }}/shoeshop_fe:v1

      - name: Docker pull
        run: docker pull ${{ secrets.DOCKERHUB_USER }}/shoeshop_fe:v1
        
      - name: Run container
        run: docker run --name shoeshop_fe -dp 3000:80 ${{ secrets.DOCKERHUB_USER }}/shoeshop_fe:v1
